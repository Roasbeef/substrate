import{a as c,u as S,q as L,j as e}from"./query-D1a_yXj4.js";import{c as C}from"./ui-ui_Xg26j.js";import{B as y,S as M,t as R}from"./index-DnrrN0sm.js";import{g as T}from"./client-5MNKdqIS.js";import{I as $}from"./Input-DANlLABD.js";import{b as E,d as z,L as B}from"./router-CqRdUfwj.js";function V(t,s){const r=encodeURIComponent(t);return T(`/search?q=${r}`,s)}const p={all:["search"],query:t=>[...p.all,"query",t],autocomplete:t=>[...p.all,"autocomplete",t]};function q(t){return L({queryKey:p.query(t),queryFn:({signal:s})=>V(t,s),enabled:t.trim().length>=2,staleTime:3e4,gcTime:6e4})}function I(t,s){const[r,n]=c.useState(t);return c.useEffect(()=>{const i=setTimeout(()=>{n(t)},s);return()=>{clearTimeout(i)}},[t,s]),r}function W(t,s=300){const r=I(t,s),n=S(q(r));return{...n,results:n.data?.data??[],isSearching:n.isFetching||t!==r&&t.trim().length>=2,debouncedQuery:r}}function D(t){switch(t.type){case"message":return{...t,route:`/inbox/thread/${t.id}`};case"thread":return{...t,route:`/inbox/thread/${t.id}`};case"agent":return{...t,route:`/agents/${t.id}`};case"topic":return{...t,route:`/topics/${t.id}`};default:return{...t,route:"/"}}}function F(t,s=300){const r=W(t,s),n=c.useMemo(()=>r.results.map(D),[r.results]);return{...r,enrichedResults:n}}function o(...t){return R(C(t))}const P=[{value:"all",label:"All"},{value:"message",label:"Messages"},{value:"thread",label:"Threads"},{value:"agent",label:"Agents"},{value:"topic",label:"Topics"}];function Q({type:t,className:s}){switch(t){case"message":return e.jsx("svg",{className:o("h-5 w-5",s),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})});case"thread":return e.jsx("svg",{className:o("h-5 w-5",s),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"})});case"agent":return e.jsx("svg",{className:o("h-5 w-5",s),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})});case"topic":return e.jsx("svg",{className:o("h-5 w-5",s),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})});default:return null}}function b({text:t,query:s}){if(!s.trim())return e.jsx("span",{children:t});const r=new RegExp(`(${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi"),n=t.split(r);return e.jsx("span",{children:n.map((i,u)=>i.toLowerCase()===s.toLowerCase()?e.jsx("mark",{className:"bg-yellow-200 text-gray-900",children:i},u):e.jsx("span",{children:i},u))})}function A({result:t,query:s}){const r={message:"text-blue-600 bg-blue-100",thread:"text-purple-600 bg-purple-100",agent:"text-green-600 bg-green-100",topic:"text-orange-600 bg-orange-100"},n={message:"Message",thread:"Thread",agent:"Agent",topic:"Topic"};return e.jsx(B,{to:t.route,className:o("block rounded-lg border border-gray-200 bg-white p-4","hover:border-blue-300 hover:bg-blue-50/50","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","transition-colors"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:o("flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg",r[t.type]),children:e.jsx(Q,{type:t.type})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"truncate text-sm font-medium text-gray-900",children:e.jsx(b,{text:t.title,query:s})}),e.jsx("span",{className:o("flex-shrink-0 rounded-full px-2 py-0.5 text-xs font-medium",r[t.type]),children:n[t.type]})]}),e.jsx("p",{className:"mt-1 line-clamp-2 text-sm text-gray-500",children:e.jsx(b,{text:t.snippet,query:s})}),e.jsx("p",{className:"mt-2 text-xs text-gray-400",children:new Date(t.created_at).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})})]})]})})}function H({query:t,hasFilter:s}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("svg",{className:"h-16 w-16 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No results found"}),e.jsx("p",{className:"mt-2 max-w-sm text-sm text-gray-500",children:t?e.jsxs(e.Fragment,{children:['No results found for "',t,'".',s&&" Try removing the filter or searching for something else.",!s&&" Try searching for something else."]}):"Enter a search term to find messages, threads, agents, and topics."})]})}function X(){const[t,s]=E();z();const r=t.get("q")??"",n=t.get("type")??"all",[i,u]=c.useState(r),[l,f]=c.useState(n),{enrichedResults:d,isSearching:x,isError:g,error:j}=F(r),h=c.useMemo(()=>l==="all"?d:d.filter(a=>a.type===l),[d,l]),v=c.useCallback(a=>{a.preventDefault();const m=i.trim();m&&s({q:m,...l!=="all"?{type:l}:{}})},[i,l,s]),k=c.useCallback(a=>{f(a),r&&s({q:r,...a!=="all"?{type:a}:{}})},[r,s]),N=c.useCallback(()=>{u(""),f("all"),s({})},[s]);return e.jsxs("div",{className:"mx-auto max-w-4xl space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Search Results"}),r&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[h.length," result",h.length!==1?"s":"",' for "',r,'"',l!=="all"&&` in ${l}s`]})]}),e.jsxs("form",{onSubmit:v,className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($,{type:"text",value:i,onChange:a=>u(a.target.value),placeholder:"Search messages, threads, agents...",className:"w-full pr-10"}),i&&e.jsx("button",{type:"button",onClick:()=>u(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(y,{type:"submit",disabled:!i.trim(),children:"Search"})]}),e.jsx("div",{className:"flex gap-2 border-b border-gray-200 pb-3",children:P.map(a=>{const m=a.value==="all"?d.length:d.filter(w=>w.type===a.value).length;return e.jsxs("button",{onClick:()=>k(a.value),className:o("rounded-full px-4 py-1.5 text-sm font-medium transition-colors",l===a.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[a.label,m>0&&e.jsx("span",{className:o("ml-1.5 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full text-xs",l===a.value?"bg-blue-500 text-white":"bg-gray-200 text-gray-600"),children:m})]},a.value)})}),e.jsxs("div",{className:"space-y-4",children:[x&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(M,{size:"lg",variant:"primary",label:"Searching..."})}),g&&e.jsxs("div",{className:"rounded-lg bg-red-50 p-4 text-center",children:[e.jsx("p",{className:"text-sm text-red-600",children:j instanceof Error?j.message:"Failed to search. Please try again."}),e.jsx(y,{variant:"outline",size:"sm",className:"mt-2",onClick:N,children:"Clear search"})]}),!x&&!g&&h.length===0&&e.jsx(H,{query:r,hasFilter:l!=="all"}),!x&&!g&&h.length>0&&e.jsx("div",{className:"space-y-3",children:h.map(a=>e.jsx(A,{result:a,query:r},`${a.type}-${a.id}`))})]})]})}export{X as default};
