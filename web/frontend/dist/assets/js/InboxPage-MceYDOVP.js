import{j as t,a as h,u as J,c as _,d as B}from"./query-D1a_yXj4.js";import{c as I}from"./ui-ui_Xg26j.js";import{t as A,u as G,a as X,b as Z}from"./index-DnrrN0sm.js";import{A as P}from"./Avatar-DGvJejrI.js";import{P as ee}from"./Badge-DHj2ErQN.js";import{p as $,a as te,g as se}from"./client-5MNKdqIS.js";import"./Input-DANlLABD.js";import"./router-CqRdUfwj.js";function k(...e){return A(I(e))}function re({className:e}){return t.jsx("svg",{className:k("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}function ne({className:e}){return t.jsx("svg",{className:k("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}function ae({className:e}){return t.jsx("svg",{className:k("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}function ie({className:e}){return t.jsx("svg",{className:k("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}const le={default:{bg:"bg-white",icon:"bg-gray-100 text-gray-600",text:"text-gray-900"},blue:{bg:"bg-blue-50",icon:"bg-blue-100 text-blue-600",text:"text-blue-900"},yellow:{bg:"bg-yellow-50",icon:"bg-yellow-100 text-yellow-600",text:"text-yellow-900"},red:{bg:"bg-red-50",icon:"bg-red-100 text-red-600",text:"text-red-900"},green:{bg:"bg-green-50",icon:"bg-green-100 text-green-600",text:"text-green-900"}};function Q({label:e,value:s,icon:r,variant:n="default",onClick:a,clickable:c=!1,className:d}){const m=le[n],l=c||a!==void 0,i=t.jsxs(t.Fragment,{children:[r?t.jsx("div",{className:k("flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg",m.icon),children:r}):null,t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-500 truncate",children:e}),t.jsx("p",{className:k("text-2xl font-semibold",m.text),children:s})]})]});return l?t.jsx("button",{type:"button",onClick:a,className:k("flex items-center gap-4 rounded-lg border border-gray-200 p-4 text-left transition-colors",m.bg,"hover:border-gray-300 hover:shadow-sm","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",d),children:i}):t.jsx("div",{className:k("flex items-center gap-4 rounded-lg border border-gray-200 p-4",m.bg,d),children:i})}function oe({unread:e,starred:s,urgent:r,acknowledged:n,onStatClick:a,isLoading:c=!1,className:d}){return c?t.jsx("div",{className:k("grid grid-cols-2 gap-4 md:grid-cols-4",d),children:[1,2,3,4].map(m=>t.jsx("div",{className:"h-20 animate-pulse rounded-lg border border-gray-200 bg-gray-100"},m))}):t.jsxs("div",{className:k("grid grid-cols-2 gap-4 md:grid-cols-4",d),children:[t.jsx(Q,{label:"Unread",value:e,icon:t.jsx(re,{}),variant:"blue",clickable:a!==void 0,onClick:()=>a?.("unread")}),t.jsx(Q,{label:"Starred",value:s,icon:t.jsx(ne,{}),variant:"yellow",clickable:a!==void 0,onClick:()=>a?.("starred")}),t.jsx(Q,{label:"Urgent",value:r,icon:t.jsx(ae,{}),variant:"red",clickable:a!==void 0,onClick:()=>a?.("urgent")}),t.jsx(Q,{label:"Completed",value:n,icon:t.jsx(ie,{}),variant:"green",clickable:a!==void 0,onClick:()=>a?.("acknowledged")})]})}function S(...e){return A(I(e))}const ce=[{id:"primary",label:"Primary"},{id:"agents",label:"Agents"},{id:"topics",label:"Topics"}];function de({tab:e,isSelected:s,onClick:r,disabled:n,variant:a}){const c="relative flex items-center gap-2 text-sm font-medium transition-colors";return a==="pills"?t.jsxs("button",{type:"button",onClick:r,disabled:n,className:S(c,"rounded-full px-4 py-2",s?"bg-blue-100 text-blue-700":"text-gray-600 hover:bg-gray-100 hover:text-gray-900",n?"cursor-not-allowed opacity-50":""),"aria-current":s?"true":void 0,children:[e.icon,t.jsx("span",{children:e.label}),e.count!==void 0&&e.count>0?t.jsx("span",{className:S("ml-1 rounded-full px-2 py-0.5 text-xs",s?"bg-blue-200 text-blue-800":"bg-gray-200 text-gray-600"),children:e.count}):null]}):t.jsxs("button",{type:"button",onClick:r,disabled:n,className:S(c,"border-b-2 pb-3 pt-2 px-1",s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700",n?"cursor-not-allowed opacity-50":""),"aria-current":s?"true":void 0,children:[e.icon,t.jsx("span",{children:e.label}),e.count!==void 0&&e.count>0?t.jsx("span",{className:S("ml-2 rounded-full px-2 py-0.5 text-xs",s?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"),children:e.count}):null]})}function ue({selected:e,onSelect:s,tabs:r=ce,disabled:n=!1,className:a,variant:c="underline"}){return t.jsx("nav",{className:S("flex",c==="underline"?"border-b border-gray-200 gap-6":"gap-2",a),"aria-label":"Category tabs",children:r.map(d=>t.jsx(de,{tab:d,isSelected:e===d.id,onClick:()=>s(d.id),disabled:n,variant:c},d.id))})}const ge=[{id:"all",label:"All"},{id:"unread",label:"Unread"},{id:"starred",label:"Starred"}];function xe({selected:e,onSelect:s,disabled:r=!1,className:n}){return t.jsx("div",{className:S("flex gap-1 rounded-lg bg-gray-100 p-1",n),children:ge.map(a=>t.jsx("button",{type:"button",onClick:()=>s(a.id),disabled:r,className:S("rounded-md px-3 py-1.5 text-sm font-medium transition-colors",e===a.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900",r?"cursor-not-allowed opacity-50":""),"aria-current":e===a.id?"true":void 0,children:a.label},a.id))})}function C(...e){return A(I(e))}function he({className:e}){return t.jsx("svg",{className:C("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}function me({className:e}){return t.jsx("svg",{className:C("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})})}function fe({className:e}){return t.jsx("svg",{className:C("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}function pe({className:e}){return t.jsx("svg",{className:C("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}function be({checked:e,indeterminate:s=!1,onChange:r,ariaLabel:n,className:a}){return t.jsx("div",{className:C("relative flex items-center",a),children:t.jsx("input",{type:"checkbox",checked:e,ref:c=>{c&&(c.indeterminate=s)},onChange:c=>r(c.target.checked),className:C("h-4 w-4 rounded border-gray-300 text-blue-600","focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"),"aria-label":n})})}function z({onClick:e,icon:s,label:r,disabled:n=!1,className:a}){return t.jsx("button",{type:"button",onClick:e,disabled:n,className:C("flex items-center justify-center rounded-md p-2","text-gray-500 hover:bg-gray-100 hover:text-gray-700","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",n?"cursor-not-allowed opacity-50":"",a),title:r,"aria-label":r,children:s})}function ye({filter:e,onFilterChange:s,selectedCount:r,totalCount:n,allSelected:a,isIndeterminate:c,onSelectAll:d,onRefresh:m,onArchive:l,onDelete:i,onStar:u,isLoading:f=!1,className:y}){const w=r>0;return t.jsxs("div",{className:C("flex items-center justify-between gap-4 border-b border-gray-200 bg-white px-4 py-2",y),children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(be,{checked:a,indeterminate:c,onChange:d,ariaLabel:a?"Deselect all":"Select all"}),w?t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[r," selected"]}),t.jsxs("div",{className:"ml-2 flex items-center border-l border-gray-200 pl-2",children:[l?t.jsx(z,{onClick:l,icon:t.jsx(me,{}),label:"Archive selected",disabled:f}):null,u?t.jsx(z,{onClick:u,icon:t.jsx(pe,{}),label:"Star selected",disabled:f}):null,i?t.jsx(z,{onClick:i,icon:t.jsx(fe,{}),label:"Delete selected",disabled:f}):null]})]}):t.jsxs("div",{className:"ml-2 flex items-center gap-2",children:[m?t.jsx(z,{onClick:m,icon:t.jsx(he,{className:f?"animate-spin":""}),label:"Refresh",disabled:f}):null,t.jsxs("span",{className:"text-sm text-gray-500",children:[n," messages"]})]})]}),t.jsx(xe,{selected:e,onSelect:s,disabled:f})]})}function v(...e){return A(I(e))}function R({filled:e=!1,className:s}){return t.jsx("svg",{className:v("h-5 w-5",s),fill:e?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}function ve({className:e}){return t.jsx("svg",{className:v("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})})}function je({className:e}){return t.jsx("svg",{className:v("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}function ke({className:e}){return t.jsx("svg",{className:v("h-5 w-5",e),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}function T(e){const s=new Date(e),n=new Date().getTime()-s.getTime(),a=Math.floor(n/6e4),c=Math.floor(n/36e5),d=Math.floor(n/864e5);return a<1?"Just now":a<60?`${a}m ago`:c<24?`${c}h ago`:d<7?`${d}d ago`:s.toLocaleDateString(void 0,{month:"short",day:"numeric"})}function we(e,s){return e.length<=s?e:e.slice(0,s)+"..."}function q({icon:e,label:s,onClick:r,className:n}){return t.jsx("button",{type:"button",onClick:r,className:v("rounded p-1.5 text-gray-400 hover:bg-gray-100 hover:text-gray-600","focus:outline-none focus:ring-2 focus:ring-blue-500","opacity-0 group-hover:opacity-100 transition-opacity",n),title:s,"aria-label":s,children:e})}function Ne({message:e,isSelected:s=!1,onSelect:r,onClick:n,onStar:a,onArchive:c,onSnooze:d,onDelete:m,showCheckbox:l=!0,className:i}){const u=e.recipients[0],f=u?.state==="unread",y=u?.is_starred??!1,w=x=>{x.stopPropagation(),r?.(x.target.checked)},N=x=>{x.stopPropagation(),a?.(!y)},j=x=>{x.stopPropagation(),c?.()},M=x=>{x.stopPropagation(),d?.()},p=x=>{x.stopPropagation(),m?.()};return t.jsxs("div",{className:v("group flex items-center gap-3 border-b border-gray-100 px-4 py-3 transition-colors",f?"bg-blue-50/50":"bg-white",s?"bg-blue-100":"",n?"cursor-pointer hover:bg-gray-50":"",i),onClick:n,role:n?"button":void 0,tabIndex:n?0:void 0,onKeyDown:n?x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),n())}:void 0,children:[l?t.jsx("div",{className:"flex-shrink-0",children:t.jsx("input",{type:"checkbox",checked:s,onChange:w,onClick:x=>x.stopPropagation(),className:v("h-4 w-4 rounded border-gray-300 text-blue-600","focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"),"aria-label":`Select message: ${e.subject}`})}):null,t.jsx("button",{type:"button",onClick:N,className:v("flex-shrink-0 p-1 rounded",y?"text-yellow-500":"text-gray-300 hover:text-yellow-400","focus:outline-none focus:ring-2 focus:ring-blue-500"),"aria-label":y?"Unstar message":"Star message",children:t.jsx(R,{filled:y,className:"h-4 w-4"})}),t.jsx(P,{name:e.sender_name,size:"sm",className:"flex-shrink-0"}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:v("truncate text-sm",f?"font-semibold text-gray-900":"font-medium text-gray-700"),children:e.sender_name}),e.priority!=="normal"?t.jsx(ee,{priority:e.priority,size:"sm"}):null]}),t.jsxs("div",{className:"flex items-baseline gap-2",children:[t.jsx("span",{className:v("truncate text-sm",f?"font-medium text-gray-900":"text-gray-600"),children:e.subject}),t.jsx("span",{className:"text-sm text-gray-400",children:"â€”"}),t.jsx("span",{className:"truncate text-sm text-gray-500",children:we(e.body,60)})]})]}),t.jsxs("div",{className:"flex flex-shrink-0 items-center gap-1",children:[c?t.jsx(q,{icon:t.jsx(ve,{className:"h-4 w-4"}),label:"Archive",onClick:j}):null,d?t.jsx(q,{icon:t.jsx(je,{className:"h-4 w-4"}),label:"Snooze",onClick:M}):null,m?t.jsx(q,{icon:t.jsx(ke,{className:"h-4 w-4"}),label:"Delete",onClick:p}):null]}),t.jsx("span",{className:"flex-shrink-0 text-xs text-gray-500",children:T(e.created_at)})]})}function Ce({message:e,onClick:s,className:r}){const n=e.recipients[0],a=n?.state==="unread",c=n?.is_starred??!1;return t.jsxs("div",{className:v("flex items-center gap-3 border-b border-gray-100 px-3 py-2 transition-colors",a?"bg-blue-50/50":"bg-white",s?"cursor-pointer hover:bg-gray-50":"",r),onClick:s,role:s?"button":void 0,tabIndex:s?0:void 0,children:[c?t.jsx(R,{filled:!0,className:"h-3 w-3 flex-shrink-0 text-yellow-500"}):null,t.jsx(P,{name:e.sender_name,size:"xs",className:"flex-shrink-0"}),t.jsx("div",{className:"min-w-0 flex-1",children:t.jsx("span",{className:v("block truncate text-sm",a?"font-medium text-gray-900":"text-gray-700"),children:e.subject})}),t.jsx("span",{className:"flex-shrink-0 text-xs text-gray-400",children:T(e.created_at)})]})}function D(...e){return A(I(e))}function Se({title:e,description:s,icon:r}){return t.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4 text-center",children:[r?t.jsx("div",{className:"mb-4 text-gray-400",children:r}):t.jsx("svg",{className:"mb-4 h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:e}),s?t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s}):null]})}function Me({compact:e=!1}){return e?t.jsxs("div",{className:"flex items-center gap-3 border-b border-gray-100 px-3 py-2",children:[t.jsx("div",{className:"h-6 w-6 animate-pulse rounded-full bg-gray-200"}),t.jsx("div",{className:"flex-1",children:t.jsx("div",{className:"h-4 w-3/4 animate-pulse rounded bg-gray-200"})}),t.jsx("div",{className:"h-3 w-12 animate-pulse rounded bg-gray-200"})]}):t.jsxs("div",{className:"flex items-center gap-3 border-b border-gray-100 px-4 py-3",children:[t.jsx("div",{className:"h-4 w-4 animate-pulse rounded bg-gray-200"}),t.jsx("div",{className:"h-4 w-4 animate-pulse rounded bg-gray-200"}),t.jsx("div",{className:"h-8 w-8 animate-pulse rounded-full bg-gray-200"}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"h-4 w-24 animate-pulse rounded bg-gray-200"}),t.jsx("div",{className:"h-4 w-12 animate-pulse rounded bg-gray-200"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"h-4 w-32 animate-pulse rounded bg-gray-200"}),t.jsx("div",{className:"h-4 w-48 animate-pulse rounded bg-gray-200"})]})]}),t.jsx("div",{className:"h-3 w-16 animate-pulse rounded bg-gray-200"})]})}function Le({messages:e,selectedIds:s=new Set,onSelectionChange:r,onMessageClick:n,onStar:a,onArchive:c,onSnooze:d,onDelete:m,isLoading:l=!1,loadingRows:i=5,isEmpty:u=!1,emptyTitle:f="No messages",emptyDescription:y="Your inbox is empty.",showCheckboxes:w=!0,compact:N=!1,className:j}){const M=h.useCallback((p,x)=>{if(!r)return;const L=new Set(s);x?L.add(p):L.delete(p),r(L)},[s,r]);return l?t.jsx("div",{className:D("divide-y divide-gray-100",j),children:Array.from({length:i},(p,x)=>t.jsx(Me,{compact:N},x))}):u||e.length===0?t.jsx(Se,{title:f,description:y}):N?t.jsx("div",{className:D("divide-y divide-gray-100",j),children:e.map(p=>t.jsx(Ce,{message:p,onClick:n?()=>n(p):void 0},p.id))}):t.jsx("div",{className:D("divide-y divide-gray-100",j),children:e.map(p=>t.jsx(Ne,{message:p,isSelected:s.has(p.id),onSelect:r?x=>M(p.id,x):void 0,onClick:n?()=>n(p):void 0,onStar:a?x=>a(p.id,x):void 0,onArchive:c?()=>c(p.id):void 0,onSnooze:d?()=>d(p.id):void 0,onDelete:m?()=>m(p.id):void 0,showCheckbox:w},p.id))})}function _e({messageIds:e}){const[s,r]=h.useState(new Set),n=h.useMemo(()=>{const l=s.size,i=e.length,u=i>0&&l===i,f=l>0&&l<i;return{selectedIds:s,selectedCount:l,totalCount:i,allSelected:u,isIndeterminate:f,hasSelection:l>0}},[s,e.length]),a=h.useCallback(l=>{r(l?new Set(e):new Set)},[e]),c=h.useCallback(()=>{r(new Set)},[]),d=h.useCallback(l=>{r(i=>{const u=new Set(i);return u.has(l)?u.delete(l):u.add(l),u})},[]),m=h.useCallback(l=>{r(l)},[]);return{...n,selectAll:a,clearSelection:c,toggleSelection:d,setSelection:m}}function Ie(e){const s=new URLSearchParams;e.page!==void 0&&s.set("page",String(e.page)),e.pageSize!==void 0&&s.set("page_size",String(e.pageSize)),e.filter!==void 0&&s.set("filter",e.filter),e.category!==void 0&&s.set("category",e.category);const r=s.toString();return r?`?${r}`:""}function Ae(e={},s){const r=Ie(e);return se(`/messages${r}`,s)}function Qe(e,s){return $(`/messages/${e}/star`,{starred:s})}function ze(e){return $(`/messages/${e}/archive`,{})}function Be(e,s){return $(`/messages/${e}/snooze`,{until:s})}function qe(e){return te(`/messages/${e}`,{state:"read"})}const g={all:["messages"],lists:()=>[...g.all,"list"],list:e=>[...g.lists(),e],details:()=>[...g.all,"detail"],detail:e=>[...g.details(),e]};function De(e={}){return J({queryKey:g.list(e),queryFn:async({signal:s})=>await Ae(e,s)})}function $e(){const e=_();return B({mutationFn:({id:s,starred:r})=>Qe(s,r),onMutate:async({id:s,starred:r})=>{await e.cancelQueries({queryKey:g.detail(s)});const n=e.getQueryData(g.detail(s));return n&&e.setQueryData(g.detail(s),{...n,recipients:n.recipients.map(a=>({...a,is_starred:r}))}),{previousMessage:n}},onError:(s,{id:r},n)=>{n?.previousMessage&&e.setQueryData(g.detail(r),n.previousMessage)},onSettled:()=>{e.invalidateQueries({queryKey:g.lists()})}})}function Pe(){const e=_();return B({mutationFn:s=>ze(s),onMutate:async s=>{await e.cancelQueries({queryKey:g.detail(s)});const r=e.getQueryData(g.detail(s));return r&&e.setQueryData(g.detail(s),{...r,recipients:r.recipients.map(n=>({...n,is_archived:!0}))}),{previousMessage:r}},onError:(s,r,n)=>{n?.previousMessage&&e.setQueryData(g.detail(r),n.previousMessage)},onSettled:()=>{e.invalidateQueries({queryKey:g.lists()})}})}function Re(){const e=_();return B({mutationFn:({id:s,until:r})=>Be(s,r),onMutate:async({id:s,until:r})=>{await e.cancelQueries({queryKey:g.detail(s)});const n=e.getQueryData(g.detail(s));return n&&e.setQueryData(g.detail(s),{...n,recipients:n.recipients.map(a=>({...a,snoozed_until:r}))}),{previousMessage:n}},onError:(s,{id:r},n)=>{n?.previousMessage&&e.setQueryData(g.detail(r),n.previousMessage)},onSettled:()=>{e.invalidateQueries({queryKey:g.lists()})}})}function Te(){const e=_();return B({mutationFn:s=>qe(s),onMutate:async s=>{await e.cancelQueries({queryKey:g.detail(s)});const r=e.getQueryData(g.detail(s));return r&&e.setQueryData(g.detail(s),{...r,recipients:r.recipients.map(n=>({...n,state:"read",read_at:new Date().toISOString()}))}),{previousMessage:r}},onError:(s,r,n)=>{n?.previousMessage&&e.setQueryData(g.detail(r),n.previousMessage)},onSettled:()=>{e.invalidateQueries({queryKey:g.lists()})}})}function We(){const e=_(),s=G(),{state:r,connect:n,disconnect:a}=X(),c=r==="connected",d=h.useRef(new Set),m=h.useCallback(l=>{if(d.current.has(l.id))return;if(d.current.add(l.id),d.current.size>100){const u=Array.from(d.current);d.current=new Set(u.slice(-50))}const i={id:l.id,sender_id:l.sender_id,sender_name:l.sender_name,subject:l.subject,body:l.body,priority:l.priority,created_at:l.created_at,recipients:[{message_id:l.id,agent_id:0,agent_name:"",state:"unread",is_starred:!1,is_archived:!1}]};e.setQueriesData({queryKey:g.lists()},u=>!u||u.data.some(y=>y.id===l.id)?u:{...u,data:[i,...u.data],meta:u.meta?{...u.meta,total:u.meta.total+1}:void 0}),e.invalidateQueries({queryKey:g.lists(),exact:!1,refetchType:"none"})},[e]);return Z(m),h.useEffect(()=>()=>{d.current.clear()},[]),{unreadCount:s,isConnected:c,connect:n,disconnect:a}}function Je(){const[e,s]=h.useState({category:"primary",filter:"all"}),r=h.useMemo(()=>{const o={};return e.filter==="unread"?o.state="unread":e.filter==="starred"&&(o.starred=!0),e.category!=="primary"&&(o.category=e.category),o},[e.category,e.filter]),{data:n,isLoading:a,error:c,refetch:d}=De(r),m=n?.data??[],l=h.useMemo(()=>m.map(o=>o.id),[m]),i=_e({messageIds:l}),u=$e(),f=Pe(),y=Re(),w=Te(),{isConnected:N}=We(),j=h.useMemo(()=>{if(!n?.data)return{unread:0,starred:0,urgent:0,acknowledged:0};const o=n.data;return{unread:o.filter(b=>b.recipients[0]?.state==="unread").length,starred:o.filter(b=>b.recipients[0]?.is_starred).length,urgent:o.filter(b=>b.priority==="urgent").length,acknowledged:o.filter(b=>b.recipients[0]?.state==="acknowledged").length}},[n?.data]),M=h.useCallback(o=>{s(b=>({...b,category:o}))},[]),p=h.useCallback(o=>{s(b=>({...b,filter:o}))},[]),x=h.useCallback(o=>{o==="unread"?s(b=>({...b,filter:"unread"})):o==="starred"&&s(b=>({...b,filter:"starred"}))},[]),L=h.useCallback(()=>{d()},[d]),W=h.useCallback(o=>{o.recipients[0]?.state==="unread"&&w.mutate(o.id),console.log("Open message:",o.id)},[w]),E=h.useCallback((o,b)=>{u.mutate({id:o,starred:b})},[u]),H=h.useCallback(o=>{f.mutate(o)},[f]),K=h.useCallback(o=>{const b=new Date;b.setHours(b.getHours()+1),y.mutate({id:o,until:b.toISOString()})},[y]),F=h.useCallback(o=>{f.mutate(o)},[f]),U=h.useCallback(()=>{i.selectedIds.forEach(o=>{f.mutate(o)}),i.clearSelection()},[i,f]),V=h.useCallback(()=>{i.selectedIds.forEach(o=>{u.mutate({id:o,starred:!0})}),i.clearSelection()},[i,u]),O=h.useCallback(()=>{i.selectedIds.forEach(o=>{f.mutate(o)}),i.clearSelection()},[i,f]),Y=u.isPending||f.isPending||y.isPending||w.isPending;return t.jsxs("div",{className:"flex h-full flex-col",children:[t.jsx("div",{className:"border-b border-gray-200 bg-gray-50 px-6 py-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(oe,{unread:j.unread,starred:j.starred,urgent:j.urgent,acknowledged:j.acknowledged,onStatClick:x,isLoading:a}),t.jsxs("div",{className:"flex items-center gap-1.5 text-xs",title:N?"Real-time updates active":"Connecting...",children:[t.jsx("span",{className:`inline-block h-2 w-2 rounded-full ${N?"bg-green-400":"bg-yellow-400 animate-pulse"}`}),t.jsx("span",{className:"text-gray-500",children:N?"Live":"Connecting"})]})]})}),t.jsx("div",{className:"border-b border-gray-200 bg-white px-6",children:t.jsx(ue,{selected:e.category,onSelect:M,disabled:a})}),t.jsx(ye,{filter:e.filter,onFilterChange:p,selectedCount:i.selectedCount,totalCount:m.length,allSelected:i.allSelected,isIndeterminate:i.isIndeterminate,onSelectAll:i.selectAll,onRefresh:L,onArchive:i.hasSelection?U:void 0,onStar:i.hasSelection?V:void 0,onDelete:i.hasSelection?O:void 0,isLoading:a||Y}),t.jsx("div",{className:"flex-1 overflow-auto",children:t.jsx(Le,{messages:m,selectedIds:i.selectedIds,onSelectionChange:i.setSelection,onMessageClick:W,onStar:E,onArchive:H,onSnooze:K,onDelete:F,isLoading:a,isEmpty:!a&&m.length===0,emptyTitle:e.filter==="unread"?"All caught up!":e.filter==="starred"?"No starred messages":"No messages",emptyDescription:e.filter==="unread"?"You have no unread messages.":e.filter==="starred"?"Star messages to find them here.":"Your inbox is empty."})}),c?t.jsx("div",{className:"fixed bottom-4 right-4 rounded-lg bg-red-50 p-4 shadow-lg",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("svg",{className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),t.jsxs("span",{className:"text-sm font-medium text-red-800",children:["Failed to load messages: ",c.message]})]})}):null]})}export{Je as default};
