{{template "layout" .}}

{{define "title"}}Inbox - Subtrate{{end}}

{{define "head"}}
<style>
    /* Google Inbox-inspired styles */
    .inbox-container {
        background-color: #f5f5f5;
        min-height: calc(100vh - 56px);
    }

    .inbox-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
        max-width: 1200px;
        margin: 0 auto;
    }

    /* Tab styling */
    .inbox-tab {
        position: relative;
        padding: 16px 32px;
        color: #5f6368;
        font-size: 14px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        transition: color 0.2s;
    }

    .inbox-tab:hover {
        color: #202124;
    }

    .inbox-tab.active {
        color: #d93025;
    }

    .inbox-tab.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background-color: #d93025;
        border-radius: 3px 3px 0 0;
    }

    .inbox-tab.social.active { color: #1a73e8; }
    .inbox-tab.social.active::after { background-color: #1a73e8; }

    .inbox-tab.topics.active { color: #188038; }
    .inbox-tab.topics.active::after { background-color: #188038; }

    /* Message row styling */
    .message-row {
        display: flex;
        align-items: center;
        height: 40px;
        padding: 0 16px;
        border-bottom: 1px solid #f1f3f4;
        cursor: pointer;
        font-size: 14px;
    }

    .message-row:hover {
        box-shadow: inset 1px 0 0 #dadce0, inset -1px 0 0 #dadce0, 0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
        z-index: 1;
    }

    .message-row.unread {
        background-color: #fff;
    }

    .message-row.unread .sender-name,
    .message-row.unread .subject,
    .message-row.unread .date {
        font-weight: 700;
    }

    /* FAB - Floating Action Button */
    .fab {
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: linear-gradient(135deg, #4285f4, #34a853, #fbbc05, #ea4335);
        box-shadow: 0 2px 5px rgba(0,0,0,.26);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: box-shadow 0.2s, transform 0.2s;
        z-index: 100;
    }

    .fab:hover {
        box-shadow: 0 4px 10px rgba(0,0,0,.3);
        transform: scale(1.05);
    }

    .fab svg {
        width: 24px;
        height: 24px;
        color: white;
    }
</style>
{{end}}

{{define "content"}}
<div class="inbox-container p-6">
    <div class="inbox-card">
        <!-- Toolbar -->
        <div class="flex items-center justify-between px-4 py-2 border-b border-gray-100">
            <div class="flex items-center gap-2">
                <!-- Select dropdown -->
                <div class="relative" onclick="event.stopPropagation()">
                    <button class="flex items-center gap-1 p-2 hover:bg-gray-100 rounded">
                        <input type="checkbox" id="select-all" class="w-4 h-4 text-gray-600 rounded border-gray-300">
                        <svg class="w-4 h-4 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>

                <!-- Refresh -->
                <button class="p-2 hover:bg-gray-100 rounded"
                        hx-get="/inbox/messages"
                        hx-target="#message-list"
                        hx-swap="innerHTML"
                        title="Refresh">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                </button>

                <!-- More actions -->
                <button class="p-2 hover:bg-gray-100 rounded" title="More">
                    <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
                    </svg>
                </button>
            </div>

            <!-- Pagination -->
            <div class="flex items-center gap-4 text-sm text-gray-600">
                <span>{{if .Messages}}1-{{len .Messages}} of {{.TotalCount}}{{else}}0{{end}}</span>
                <div class="flex items-center">
                    <button class="p-1 hover:bg-gray-100 rounded disabled:opacity-30"
                            hx-get="/inbox/messages?page={{.PrevPage}}"
                            hx-target="#message-list"
                            {{if not .HasPrev}}disabled{{end}}>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button class="p-1 hover:bg-gray-100 rounded disabled:opacity-30"
                            hx-get="/inbox/messages?page={{.NextPage}}"
                            hx-target="#message-list"
                            {{if not .HasNext}}disabled{{end}}>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Category Tabs (like Gmail Primary/Social/Promotions) -->
        <div class="flex border-b border-gray-200">
            <a href="/inbox?category=primary"
               class="inbox-tab {{if or (not .Category) (eq .Category "primary")}}active{{end}}">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                </svg>
                Primary
            </a>
            <a href="/inbox?category=agents"
               class="inbox-tab social {{if eq .Category "agents"}}active{{end}}">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                </svg>
                Agents
            </a>
            <a href="/inbox?category=topics"
               class="inbox-tab topics {{if eq .Category "topics"}}active{{end}}">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/>
                </svg>
                Topics
            </a>
        </div>

        <!-- Message List -->
        <div id="message-list"
             hx-get="/inbox/messages{{if .Category}}?category={{.Category}}{{end}}"
             hx-trigger="load"
             hx-swap="innerHTML">
            <div class="p-8 text-center text-gray-500">
                <svg class="animate-spin w-6 h-6 mx-auto mb-2" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
                </svg>
                Loading...
            </div>
        </div>
    </div>
</div>

<!-- Floating Action Button (Compose) -->
<button class="fab"
        hx-get="/compose"
        hx-target="#modal-container"
        hx-swap="innerHTML"
        title="Compose">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
    </svg>
</button>

<!-- Real-time updates via SSE -->
<div hx-ext="sse" sse-connect="/events/inbox" class="hidden">
    <div sse-swap="new-message" hx-swap="afterbegin" hx-target="#message-list"></div>
    <div sse-swap="unread-count" hx-swap="innerHTML" hx-target="#unread-badge"></div>
</div>
{{end}}

{{define "scripts"}}
<script>
// Select all functionality
document.getElementById('select-all')?.addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('input[name="message-ids"]');
    checkboxes.forEach(cb => cb.checked = this.checked);
});
</script>
{{end}}
