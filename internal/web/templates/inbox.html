{{define "inbox.html"}}
{{template "layout" .}}
{{end}}

{{define "title"}}Inbox - Subtrate{{end}}

{{define "head"}}
<style>
    /* Google Inbox-inspired container */
    .inbox-container {
        background-color: #f5f5f5;
        min-height: calc(100vh - 56px);
    }

    .inbox-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
        max-width: 1200px;
        margin: 0 auto;
    }

    /* Gmail-style tabs with proper spacing */
    .inbox-tabs {
        display: flex;
        border-bottom: 1px solid #e0e0e0;
    }

    .inbox-tab {
        position: relative;
        padding: 14px 48px;
        color: #5f6368;
        font-size: 13px;
        font-weight: 500;
        letter-spacing: 0.25px;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        text-decoration: none;
        transition: background-color 0.15s, color 0.15s;
        border-bottom: 3px solid transparent;
        margin-bottom: -1px;
    }

    .inbox-tab:hover {
        background-color: #f6f8fc;
    }

    .inbox-tab.active {
        color: #d93025;
        border-bottom-color: #d93025;
        background-color: #fce8e6;
    }

    .inbox-tab svg {
        width: 18px;
        height: 18px;
    }

    /* Category-specific colors */
    .inbox-tab.agents.active {
        color: #1a73e8;
        border-bottom-color: #1a73e8;
        background-color: #e8f0fe;
    }

    .inbox-tab.topics.active {
        color: #188038;
        border-bottom-color: #188038;
        background-color: #e6f4ea;
    }

    /* Time section dividers (Google Inbox style) */
    .time-section {
        padding: 12px 16px 8px 16px;
        font-size: 12px;
        font-weight: 500;
        color: #5f6368;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        background: #fafafa;
        border-bottom: 1px solid #e0e0e0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .time-section .mark-done {
        color: #5f6368;
        opacity: 0;
        transition: opacity 0.15s;
    }

    .time-section:hover .mark-done {
        opacity: 1;
    }

    /* Message row - Gmail clean style */
    .message-row {
        display: flex;
        align-items: center;
        height: 40px;
        padding: 0 8px 0 0;
        border-bottom: 1px solid #f1f3f4;
        cursor: pointer;
        font-size: 14px;
        line-height: 20px;
        transition: box-shadow 0.1s;
    }

    .message-row:hover {
        box-shadow: inset 1px 0 0 #dadce0, inset -1px 0 0 #dadce0,
                    0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
        z-index: 2;
        position: relative;
    }

    .message-row.unread {
        background-color: #fff;
    }

    .message-row.unread .msg-sender,
    .message-row.unread .msg-subject {
        font-weight: 700;
        color: #202124;
    }

    .message-row.unread .msg-date {
        font-weight: 600;
        color: #202124;
    }

    /* Message row columns */
    .msg-checkbox {
        width: 40px;
        flex-shrink: 0;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .msg-star {
        width: 32px;
        flex-shrink: 0;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .msg-star svg {
        width: 20px;
        height: 20px;
    }

    .msg-sender {
        width: 200px;
        flex-shrink: 0;
        padding-right: 16px;
        color: #202124;
        font-weight: 400;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .msg-content {
        flex: 1;
        min-width: 0;
        display: flex;
        align-items: baseline;
        gap: 4px;
        overflow: hidden;
    }

    .msg-subject {
        color: #202124;
        font-weight: 400;
        white-space: nowrap;
    }

    .msg-separator {
        color: #5f6368;
        flex-shrink: 0;
    }

    .msg-preview {
        color: #5f6368;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .msg-labels {
        flex-shrink: 0;
        padding: 0 8px;
    }

    .msg-label {
        display: inline-block;
        padding: 2px 6px;
        font-size: 11px;
        font-weight: 500;
        border-radius: 4px;
        background: #e8eaed;
        color: #5f6368;
    }

    .msg-date {
        width: 70px;
        flex-shrink: 0;
        text-align: right;
        color: #5f6368;
        font-size: 12px;
        padding-right: 8px;
    }

    /* Hover actions */
    .msg-actions {
        width: 0;
        overflow: hidden;
        display: flex;
        align-items: center;
        gap: 4px;
        transition: width 0.15s;
    }

    .message-row:hover .msg-actions {
        width: 88px;
    }

    .message-row:hover .msg-date {
        display: none;
    }

    .msg-actions button {
        padding: 6px;
        border-radius: 50%;
        color: #5f6368;
        background: transparent;
        border: none;
        cursor: pointer;
    }

    .msg-actions button:hover {
        background-color: #e8eaed;
    }

    .msg-actions svg {
        width: 18px;
        height: 18px;
    }

    /* Important/Priority indicator */
    .priority-indicator {
        width: 4px;
        height: 100%;
        flex-shrink: 0;
    }

    .priority-urgent {
        background-color: #d93025;
    }

    /* FAB - Floating Action Button */
    .fab {
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: linear-gradient(135deg, #4285f4, #34a853, #fbbc05, #ea4335);
        box-shadow: 0 2px 5px rgba(0,0,0,.26);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: box-shadow 0.2s, transform 0.2s;
        z-index: 100;
        border: none;
    }

    .fab:hover {
        box-shadow: 0 4px 10px rgba(0,0,0,.3);
        transform: scale(1.05);
    }

    .fab svg {
        width: 24px;
        height: 24px;
        color: white;
    }

    /* Empty state */
    .inbox-empty {
        padding: 80px 24px;
        text-align: center;
    }

    .inbox-empty svg {
        width: 120px;
        height: 120px;
        color: #dadce0;
        margin-bottom: 16px;
    }

    .inbox-empty h3 {
        font-size: 22px;
        font-weight: 400;
        color: #202124;
        margin-bottom: 8px;
    }

    .inbox-empty p {
        font-size: 14px;
        color: #5f6368;
    }
</style>
{{end}}

{{define "content"}}
<div class="inbox-container p-6">
    <div class="inbox-card">
        <!-- Toolbar -->
        <div class="flex items-center justify-between px-2 py-2 border-b border-gray-100">
            <div class="flex items-center gap-1">
                <!-- Select dropdown -->
                <div class="flex items-center" onclick="event.stopPropagation()">
                    <button class="flex items-center gap-0.5 p-2 hover:bg-gray-100 rounded">
                        <input type="checkbox" id="select-all" class="w-4 h-4 rounded border-gray-300">
                        <svg class="w-4 h-4 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>

                <!-- Refresh -->
                <button class="p-2 hover:bg-gray-100 rounded"
                        hx-get="/inbox/messages"
                        hx-target="#message-list"
                        hx-swap="innerHTML"
                        title="Refresh">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                </button>

                <!-- More actions -->
                <button class="p-2 hover:bg-gray-100 rounded" title="More">
                    <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
                    </svg>
                </button>
            </div>

            <!-- Pagination -->
            <div class="flex items-center gap-4 text-sm text-gray-600">
                <span class="text-xs">{{if .Messages}}1â€“{{len .Messages}} of {{.TotalCount}}{{else}}0{{end}}</span>
                <div class="flex items-center">
                    <button class="p-1.5 hover:bg-gray-100 rounded disabled:opacity-30"
                            hx-get="/inbox/messages?page={{.PrevPage}}"
                            hx-target="#message-list"
                            {{if not .HasPrev}}disabled{{end}}>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button class="p-1.5 hover:bg-gray-100 rounded disabled:opacity-30"
                            hx-get="/inbox/messages?page={{.NextPage}}"
                            hx-target="#message-list"
                            {{if not .HasNext}}disabled{{end}}>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Category Tabs (Gmail style with proper spacing) -->
        <div class="inbox-tabs">
            <a href="/inbox?category=primary"
               class="inbox-tab {{if or (not .Category) (eq .Category "primary")}}active{{end}}">
                <svg fill="currentColor" viewBox="0 0 24 24">
                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                </svg>
                Primary
            </a>
            <a href="/inbox?category=agents"
               class="inbox-tab agents {{if eq .Category "agents"}}active{{end}}">
                <svg fill="currentColor" viewBox="0 0 24 24">
                    <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                </svg>
                Agents
            </a>
            <a href="/inbox?category=topics"
               class="inbox-tab topics {{if eq .Category "topics"}}active{{end}}">
                <svg fill="currentColor" viewBox="0 0 24 24">
                    <path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/>
                </svg>
                Topics
            </a>
        </div>

        <!-- Message List -->
        <div id="message-list"
             hx-get="/inbox/messages{{if .Category}}?category={{.Category}}{{end}}"
             hx-trigger="load"
             hx-swap="innerHTML">
            <div class="p-8 text-center text-gray-500">
                <svg class="animate-spin w-6 h-6 mx-auto mb-2" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
                </svg>
                Loading...
            </div>
        </div>
    </div>
</div>

<!-- Floating Action Button (Compose) -->
<button class="fab"
        hx-get="/compose"
        hx-target="#modal-container"
        hx-swap="innerHTML"
        title="Compose">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
    </svg>
</button>

<!-- Real-time updates via SSE -->
<div hx-ext="sse" sse-connect="/events/inbox" class="hidden">
    <div sse-swap="new-message" hx-swap="afterbegin" hx-target="#message-list"></div>
    <div sse-swap="unread-count" hx-swap="innerHTML" hx-target="#unread-badge"></div>
</div>
{{end}}

{{define "scripts"}}
<script>
// Select all functionality
document.getElementById('select-all')?.addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('input[name="message-ids"]');
    checkboxes.forEach(cb => cb.checked = this.checked);
});
</script>
{{end}}
