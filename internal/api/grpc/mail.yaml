type: google.api.Service
config_version: 3

# gRPC to REST mapping for Subtrate Mail service.
# This file is used by grpc-gateway to generate REST proxy handlers.
# Pattern based on lnd's lnrpc/lightning.yaml.

http:
  rules:
    # Mail Service - Message Operations
    - selector: subtraterpc.Mail.SendMail
      post: "/api/v1/messages"
      body: "*"

    - selector: subtraterpc.Mail.FetchInbox
      get: "/api/v1/messages"

    - selector: subtraterpc.Mail.ReadMessage
      get: "/api/v1/messages/{message_id}"

    - selector: subtraterpc.Mail.UpdateState
      patch: "/api/v1/messages/{message_id}"
      body: "*"

    - selector: subtraterpc.Mail.AckMessage
      post: "/api/v1/messages/{message_id}/ack"
      body: "*"

    # Mail Service - Thread Operations
    - selector: subtraterpc.Mail.ReadThread
      get: "/api/v1/threads/{thread_id}"

    # Mail Service - Status Operations
    - selector: subtraterpc.Mail.GetStatus
      get: "/api/v1/status/{agent_id}"

    - selector: subtraterpc.Mail.PollChanges
      post: "/api/v1/poll"
      body: "*"

    # Mail Service - Streaming (no REST mapping, WebSocket only)
    # SubscribeInbox is intentionally not mapped - use WebSocket

    # Mail Service - Pub/Sub Operations
    - selector: subtraterpc.Mail.Publish
      post: "/api/v1/publish"
      body: "*"

    - selector: subtraterpc.Mail.Subscribe
      post: "/api/v1/subscribe"
      body: "*"

    - selector: subtraterpc.Mail.Unsubscribe
      post: "/api/v1/unsubscribe"
      body: "*"

    - selector: subtraterpc.Mail.ListTopics
      get: "/api/v1/topics"

    # Mail Service - Search
    - selector: subtraterpc.Mail.Search
      get: "/api/v1/search"

    # Mail Service - Status Dedup Check
    - selector: subtraterpc.Mail.HasUnackedStatusTo
      get: "/api/v1/status/pending/{sender_id}/{recipient_id}"

    # Mail Service - Thread Operations
    - selector: subtraterpc.Mail.ReplyToThread
      post: "/api/v1/threads/{thread_id}/reply"
      body: "*"

    - selector: subtraterpc.Mail.ArchiveThread
      post: "/api/v1/threads/{thread_id}/archive"
      body: "*"

    - selector: subtraterpc.Mail.DeleteThread
      post: "/api/v1/threads/{thread_id}/delete"
      body: "*"

    - selector: subtraterpc.Mail.MarkThreadUnread
      post: "/api/v1/threads/{thread_id}/unread"
      body: "*"

    # Mail Service - Topic Operations
    - selector: subtraterpc.Mail.GetTopic
      get: "/api/v1/topics/{topic_id}"

    # Mail Service - Autocomplete
    - selector: subtraterpc.Mail.AutocompleteRecipients
      get: "/api/v1/autocomplete/recipients"

    # Mail Service - Delete Message
    - selector: subtraterpc.Mail.DeleteMessage
      post: "/api/v1/messages/{message_id}/delete"
      body: "*"

    # Agent Service - Agent Management
    - selector: subtraterpc.Agent.RegisterAgent
      post: "/api/v1/agents"
      body: "*"

    - selector: subtraterpc.Agent.GetAgent
      get: "/api/v1/agents/{agent_id}"
      additional_bindings:
        - get: "/api/v1/agents/by-name/{name}"

    - selector: subtraterpc.Agent.ListAgents
      get: "/api/v1/agents"

    - selector: subtraterpc.Agent.DeleteAgent
      delete: "/api/v1/agents/{id}"

    # Agent Service - Extended Operations
    - selector: subtraterpc.Agent.UpdateAgent
      patch: "/api/v1/agents/{id}"
      body: "*"

    - selector: subtraterpc.Agent.GetAgentsStatus
      get: "/api/v1/agents/status"

    - selector: subtraterpc.Agent.Heartbeat
      post: "/api/v1/heartbeat"
      body: "*"

    # Agent Service - Identity Management
    - selector: subtraterpc.Agent.EnsureIdentity
      post: "/api/v1/identity"
      body: "*"

    - selector: subtraterpc.Agent.SaveIdentity
      put: "/api/v1/identity"
      body: "*"

    # Session Service
    - selector: subtraterpc.Session.ListSessions
      get: "/api/v1/sessions"

    - selector: subtraterpc.Session.GetSession
      get: "/api/v1/sessions/{session_id}"

    - selector: subtraterpc.Session.StartSession
      post: "/api/v1/sessions"
      body: "*"

    - selector: subtraterpc.Session.CompleteSession
      post: "/api/v1/sessions/{session_id}/complete"
      body: "*"

    # Activity Service
    - selector: subtraterpc.Activity.ListActivities
      get: "/api/v1/activities"

    # Stats Service
    - selector: subtraterpc.Stats.GetDashboardStats
      get: "/api/v1/stats/dashboard"

    - selector: subtraterpc.Stats.HealthCheck
      get: "/api/v1/health"
